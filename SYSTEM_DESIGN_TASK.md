# System Architecture Design: High-Scale Web Application
> Generated by Ralph AI based on provided capacity estimates.

## 1. Requirements Clarification (Assumed)

Since specific functional requirements were not provided, we assume a **Generic Content Platform** (e.g., Social Feed, News App) based on the usage patterns (1M DAU, 50 req/user/day).

### Functional Requirements
- **User Action**: Users can view feeds, post updates, and interact (like/comment).
- **Workflows**: Login -> View Feed (Read heavy) -> Post Content (Write).

### Non-Functional Requirements
- **Performance**: < 200ms latency for feed retrieval.
- **Availability**: 99.99% (max 52 mins downtime/year).
- **Consistency**: Eventual consistency for feeds; Strong consistency for user profiles/auth.
- **Scalability**: Support 3x peak traffic (1740 RPS).

## 2. Capacity Estimation (Recap)
- **DAU**: 1M
- **RPS**: ~580 avg / ~1740 peak
- **Bandwidth**: 3.5 MB/s
- **Storage**: ~70GB over 5 years (Structured Data) + Object Storage (Media).

## 3. High-Level Architecture

```
                                  ┌──────────────┐
                                  │  CDN (Edge)  │
                                  │ (Static/IMG) │
                                  └──────┬───────┘
                                         │
┌──────────────┐                  ┌──────▼───────┐
│    Client    │ ◄──────────────► │ Load Balancer│
└──────────────┘                  │   (AWS ALB)  │
                                  └──────┬───────┘
                                         │
                    ┌────────────────────┴────────────────────┐
                    │                                         │
             ┌──────▼──────┐                           ┌──────▼──────┐
             │ API Gateway │                           │ Auth Service│
             │ (Rate Limit)│                           │   (OAuth)   │
             └──────┬──────┘                           └──────┬──────┘
                    │                                         │
      ┌─────────────┼───────────────┬──────────────────┐      │
      │             │               │                  │      │
┌─────▼────┐  ┌─────▼─────┐   ┌─────▼─────┐      ┌─────▼──────▼─────┐
│  Feed    │  │  Content  │   │ Interaction│     │    User DB       │
│ Service  │  │  Service  │   │  Service   │     │  (PostgreSQL)    │
└─────┬────┘  └─────┬─────┘   └─────┬─────┘      └──────────────────┘
      │             │               │
┌─────▼────┐  ┌─────▼─────┐   ┌─────▼─────┐
│  Redis   │  │ Obj Store │   │ Kafka (MQ)│
│ (Cache)  │  │   (S3)    │   │ (Async)   │
└──────────┘  └───────────┘   └─────┬─────┘
                                    │
                              ┌─────▼─────┐
                              │ Analytics │
                              │  Worker   │
                              └───────────┘
```

## 4. Component Design

### Load Balancer & API Gateway
- **ALB**: Termination of SSL, distribution of traffic across AZs.
- **API Gateway**: Handles Rate Limiting (100 req/min/user), Request Routing, and Authentication verification (JWT).

### Services (Microservices)
- **Content Service**: Handles CRUD for posts. Writes to DB, uploads media to S3.
- **Feed Service**: Aggregates posts. Uses **Fan-out on Write** for active users (pushes post IDs to user's Redis list) for fast retrieval.
- **Interaction Service**: Handles likes/comments. High write throughput, buffers writes via Kafka.

### Storage Layer
- **Primary DB (PostgreSQL)**: Stores User profiles, Post metadata, Graph relationships (followers).
    - *Sharding*: Based on `User_ID` for infinite horizontal scale.
- **Object Storage (S3)**: Stores images/videos. Served via CloudFront CDN.
- **Cache (Redis)**:
    - *Session Store*: User tokens.
    - *Feed Cache*: Pre-computed feed lists for active users.
    - *Content Cache*: Hot posts.

## 5. Data Flow

### Read Flow (View Feed)
1. Client -> LB -> Feed Service.
2. Feed Service checks **Redis** for pre-computed feed.
3. If miss, query **Follower Graph** (DB) -> Get recent posts -> Aggregate.
4. Hydrate content (get text/image URLs) from Cache/DB.
5. Return JSON to Client.

### Write Flow (Create Post)
1. Client -> LB -> Content Service.
2. Content Service validates input & Uploads image to S3.
3. Persists metadata to **Primary DB**.
4. Publishes `New_Post` event to **Kafka**.
5. **Feed Worker** consumes event -> Fan-out to followers' Redis feeds.

## 6. Scalability & Fault Tolerance
- **Stateless Services**: All services (Feed, Content) scale horizontally (Auto Scaling Group).
- **Database**:
    - **Read Replicas**: 3 Replicas for high availability and read-scaling.
    - **Pgbouncer**: Connection pooling.
- **Circuit Breakers**: Implemented in services to prevent cascading failures if DB is slow.

## 7. Technology Stack
- **Frontend**: React (Web), React Native (Mobile).
- **Backend**: Go (high throughput services), Node.js (API Gateway).
- **DB**: PostgreSQL (Reliability), Redis (Speed), Cassandra (optional for Interaction history if massive).
- **Infrastructure**: AWS (EKS/Kubernetes), Terraform (IaC).
